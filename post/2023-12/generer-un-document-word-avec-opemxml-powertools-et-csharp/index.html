<!doctype html><html lang=fr-fr dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='Depuis que Microsoft Office a sorti la version Microsoft Office 2007, les documents de la suite Office sont plus interopérables avec l’OpenDocument et surtout, il n’est pas nécessaire d’utiliser une librairie propriétaire pour éditer programmatiquement les documents .docx'><title>Générer un document Word avec OpenXml PowerTools</title>
<link rel=canonical href=https://jeremielitzLer.fr/post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/ itemprop=url><link rel=stylesheet href=/scss/style.min.d8118f156935b64eca93aca758476adca858d2c47354971654d9bd2933a0e45f.css><meta property='og:title' content='Générer un document Word avec OpenXml PowerTools'><meta property='og:description' content='Depuis que Microsoft Office a sorti la version Microsoft Office 2007, les documents de la suite Office sont plus interopérables avec l’OpenDocument et surtout, il n’est pas nécessaire d’utiliser une librairie propriétaire pour éditer programmatiquement les documents .docx'><meta property='og:url' content='https://jeremielitzLer.fr/post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/'><meta property='og:site_name' content='Jérémie Litzler'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2023-12-12T00:00:00+00:00'><meta property='article:modified_time' content='2023-12-12T00:00:00+00:00'><meta property='og:image' content='https://jeremielitzLer.fr/post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/exemple-de-modele-word-et-son-equivalent-sans-les-balises.jpg'><meta name=twitter:title content="Générer un document Word avec OpenXml PowerTools"><meta name=twitter:description content="Depuis que Microsoft Office a sorti la version Microsoft Office 2007, les documents de la suite Office sont plus interopérables avec l’OpenDocument et surtout, il n’est pas nécessaire d’utiliser une librairie propriétaire pour éditer programmatiquement les documents .docx"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://jeremielitzLer.fr/post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/exemple-de-modele-word-et-son-equivalent-sans-les-balises.jpg'><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=https://jeremielitzLer.fr/css/custom-style.css></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Afficher le menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/profilepic-400w_hu0d260670f142c28330b6a3dd6fbeddc8_111803_300x0_resize_q75_box.jpg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><p class=site-name><a href=/>Jérémie Litzler</a></p><p class=site-description>Je partage ici mes notes et experiences que, je suis sûr, seront utiles pour au moins une personne. Bonne lecture !</p></div></header><ol class=social-menu><li><a href=https://github.com/JeremieLitzler target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/jeremielitzler/ target=_blank title=LinkedIn rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-linkedin" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></a></li><li><a href=https://twitter.com/LitzlerJeremie target=_blank title=Twitter rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-x" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16H20L8.267 4z"/><path d="M4 20l6.768-6.768m2.46-2.46L20 4"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Accueil</span></a></li><li><a href=/page/a-propos/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>Qui suis-je ?</span></a></li><li><a href=/page/soutenez-moi/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-heart-handshake" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#707070" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M19.5 12.572 12 20l-7.5-7.428A5 5 0 1112 6.006a5 5 0 117.5 6.572"/><path d="M12 6 8.707 9.293a1 1 0 000 1.414l.543.543c.69.69 1.81.69 2.5.0l1-1a3.182 3.182.0 014.5.0l2.25 2.25"/><path d="M12.5 15.5l2 2"/><path d="M15 13l2 2"/></svg>
<span>Soutenez mon travail</span></a></li><li><a href=/page/contactez-moi/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-message-chatbot" width="44" height="44" viewBox="0 0 24 24" stroke-width="1.5" stroke="#707070" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 21V8a3 3 0 013-3h10a3 3 0 013 3v6a3 3 0 01-3 3H8l-4 4"/><path d="M9.5 9h.01"/><path d="M14.5 9h.01"/><path d="M9.5 13a3.5 3.5.0 005 0"/></svg>
<span>Contactez-moi</span></a></li><li><a href=/page/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Rechercher</span></a></li><li><a href=/page/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archive d'articles</span></a></li><div class=menu-bottom-section><li id=i18n-switch><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 5h7"/><path d="M9 3v2c0 4.418-2.239 8-5 8"/><path d="M5 9c-.003 2.144 2.952 3.908 6.7 4"/><path d="M12 20l4-9 4 9"/><path d="M19.1 18h-6.2"/></svg>
<select name=language onchange="window.location.href=this.selectedOptions[0].value"><option value=https://jeremielitzLer.fr/ selected></option></select></li><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Mode sombre</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table des matières</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#présentation-de-office-open-xml>Présentation de <code>Office Open XML</code></a></li><li><a href=#la-solution>La solution</a></li><li><a href=#lalgorithme-de-génération>L’algorithme de génération</a></li><li><a href=#le-code>Le code</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/><img src=/post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/_hueea3a30a1677da30a5b62a1531a513fd_460496_5231fbec8630825e8f952a2d9a51266c.jpg srcset="/post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/_hueea3a30a1677da30a5b62a1531a513fd_460496_013c4e05a8bf23026444ed54f4d5b7cf.jpg 360w, /post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/_hueea3a30a1677da30a5b62a1531a513fd_460496_5231fbec8630825e8f952a2d9a51266c.jpg 600w, /post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/_hueea3a30a1677da30a5b62a1531a513fd_460496_0bc3e9ac4e4624e2695c6cb1158e4dd6.jpg 1024w" width=600 height=360 alt="Image de l'article 'Générer un document Word avec OpenXml PowerTools'"></a></div><div class=article-details><header class=article-category><a href=/categories/tutoriels/>Tutoriels</a></header><div class=article-title-wrapper><h1 class=article-title><a href=/post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/>Générer un document Word avec OpenXml PowerTools</a></h1><h2 class=article-subtitle>Depuis que Microsoft Office a sorti la version Microsoft Office 2007, les documents de la suite Office sont plus interopérables avec l’OpenDocument et surtout, il n’est pas nécessaire d’utiliser une librairie propriétaire pour éditer programmatiquement les documents .docx</h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>12/12/2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>4 minutes de lecture</time></div></footer></div></header><section class=article-content><p>Pour un projet, j’ai eu la tâche de :</p><ul><li>Prendre un modèle de document Word contenant des balises prédéfinies par un besoin spécifique client,</li><li>Remplacer lesdites balises par des données dynamiquement issues d’une base de données.</li><li>Permettre la préservation des styles du modèle (texte gras, surligné, sous-ligné, de différentes, etc.) même après le remplacement des balises.</li></ul><p>Dans cet article, je partage ce que j’ai appris et comment j’ai atteint le but.</p><h2 id=présentation-de-office-open-xml>Présentation de <code>Office Open XML</code></h2><p>Après une petite recherche sur Google, je comprends vite que le format de document Word aujourd’hui respecte <em>la norme ISO/CEI 29500 créée par Microsoft, destinée à répondre à la demande d’interopérabilité dans les environnements de bureautique et à concurrencer la solution d’interopérabilité OpenDocument soutenue par tous les autres éditeurs de suites bureautiques, notamment Apache et The Document Foundation</em> (source : <a href=https://fr.wikipedia.org/wiki/Office_Open_XML>Wikipedia</a>).</p><p>En lisant les divers articles, je comprends que renommer un fichier <code>mon-document.docx</code> en <code>mon-document.docx.zip</code> permet ensuite de dézipper le fichier et obtenir ceci :</p><p><img src=/post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/exemple-de-modele-word-dezippe.jpg width=1200 height=611 srcset="/post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/exemple-de-modele-word-dezippe_hu67dfaabde3c16a519ce57c83f75e2d3b_86240_360x0_resize_q75_box.jpg 360w, /post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/exemple-de-modele-word-dezippe_hu67dfaabde3c16a519ce57c83f75e2d3b_86240_600x0_resize_q75_box.jpg 600w, /post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/exemple-de-modele-word-dezippe_hu67dfaabde3c16a519ce57c83f75e2d3b_86240_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt="Exemple de modèle Word « dézippé »" class=gallery-image data-flex-grow=196 data-flex-basis=471px></p><p>Les fichiers <code>XML</code> définissent le document Word.</p><p>Par exemple, le fichier <code>document.xml</code> correspond au contenu au format <code>XML</code> .</p><p><img src=/post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/exemple-de-contenu-du-document-word-en-xml.jpg width=1200 height=591 srcset="/post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/exemple-de-contenu-du-document-word-en-xml_hu6d63e167b3cc0d2e176e3b56d43dec1f_540532_360x0_resize_q75_box.jpg 360w, /post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/exemple-de-contenu-du-document-word-en-xml_hu6d63e167b3cc0d2e176e3b56d43dec1f_540532_600x0_resize_q75_box.jpg 600w, /post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/exemple-de-contenu-du-document-word-en-xml_hu6d63e167b3cc0d2e176e3b56d43dec1f_540532_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt="Exemple de contenu du document Word en XML" class=gallery-image data-flex-grow=203 data-flex-basis=487px></p><p>On voit bien les balises entourées de leurs <em>doubles moustaches</em>, par exemple <code>{{FirstName}} {{LastName}}</code> .</p><div class="jli-notice jli-notice-tip" id="Au passage..."><p class=jli-notice-title>Au passage...</p><p>Le choix de <code>{{Balise}}</code> est arbitraire.</p><p>J’aurais aussi bien pu utiliser <code>{Balise}</code> ou <code>[Balise]</code> ou même <code>%Balise%</code> .</p><p>C’est l’appelant de la librairie de génération qui définit les balises. Le générateur lui-même ne fait que prendre les balises et les remplacer avec la donnée associée.</p></div><p>On voit aussi dans l’XML que, pour d’autres balises, on peut se demander comment le remplacement va être possible.</p><p><img src=/post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/balises-non-eclatees-vs-balises-eclatees.jpg width=891 height=755 srcset="/post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/balises-non-eclatees-vs-balises-eclatees_hu07fe510ea6310c840214d271b7b63466_187322_360x0_resize_q75_box.jpg 360w, /post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/balises-non-eclatees-vs-balises-eclatees_hu07fe510ea6310c840214d271b7b63466_187322_600x0_resize_q75_box.jpg 600w, /post/2023-12/generer-un-document-word-avec-opemxml-powertools-et-csharp/images/balises-non-eclatees-vs-balises-eclatees_hu07fe510ea6310c840214d271b7b63466_187322_1024x0_resize_q75_box.jpg 1024w" loading=lazy alt="Balises « non éclatées » vs balises « éclatées »" class=gallery-image data-flex-grow=118 data-flex-basis=283px></p><p>Que s’est-il passé sur la balise <code>{{AddressLane}}</code> ? En fait, en éditant le document (suppression, ajout de caractères, correction, etc.), le texte qui compose la balise peut être découpée en <code>&lt;w:t>...&lt;/w:t></code> par Microsoft Word (<code>w:t</code> est défini <a href=http://www.datypic.com/sc/ooxml/e-w_t-1.html>ici dans la spécification OOXML</a>).</p><p>Du coup, quand on veut remplacer<code>{{AddressLane}}</code>, comment fait-on ?</p><h2 id=la-solution>La solution</h2><p>La théorie est très bien détaillée <a href=https://stackoverflow.com/a/59328568>dans cette réponse</a> de <a href=https://stackoverflow.com/users/4654643/thomas-barnekow>Thomas Barnekow</a> sur Stackoverflow.</p><p>Thomas utilise deux librairies disponibles sur Nuget.org pour démontrer le remplacement efficace des balises :</p><ul><li><code>DocumentFormat.OpenXml</code> (version 3.0.0 au 12/12/2023)<ul><li>cette librairie est la librairie officielle de Microsoft pour lire les documents<code>OpenXml</code> .</li><li>Voici le dépôt de la librairie <a href=https://github.com/dotnet/Open-XML-SDK><code>DocumentFormat.OpenXml</code></a></li></ul></li><li>Open-Xml-PowerTools (version 4.5.3.2 au 12/12/2023)<ul><li>Cette librairie étend <code>DocumentFormat.OpenXml</code> avec des outils très pratiques, comme le remplacement des balises.</li><li>Voici le dépôt de la librairie <a href=https://github.com/OpenXmlDev/Open-Xml-PowerTools><code>Open-Xml-PowerTools</code></a></li></ul></li></ul><p>Je me suis inspiré de <a href=https://github.com/OpenXmlDev/Open-Xml-PowerTools/tree/vNext/OpenXmlPowerToolsExamples/TextReplacer02>l’exemple de génération <code>TextReplacer02</code></a> avec Open-Xml-PowerTools.</p><h2 id=lalgorithme-de-génération>L’algorithme de génération</h2><p>Pour transformer un modèle de document <code>.docx</code> avec des balises personnalisées, l’algorithme est le suivant :</p><ul><li><p>On lit les données dynamiques.</p><ul><li>Dans mon exemple, je définis 2 objets en dur pour faire simple. J’utilise l’outil <em><a href=https://www.fakenamegenerator.com/>Fake Name Generator</a></em> pour obtenir deux identités de personnes.</li><li>Dans le projet que j’ai réalisé, les données provenaient d’une base de données MSSQL avec l’utilisation d’EF Core.</li></ul></li><li><p>On réalise une copie du modèle.</p><ul><li>Dans mon projet d’exemple, le document est copié dans le dossier <code>bin\GeneratedDocx</code> du projet de tests.</li><li>Dans le cas du projet que j’ai réalisé, je devais copier le modèle du dossier source stockant les modèles à un dossier séparé en le nommant par exemple <code>generated-[GUID].docx</code> .</li></ul></li><li><p>Ouvrir <strong>en écriture</strong> la copie du modèle.</p></li></ul><div class="jli-notice jli-notice-tip" id="Lire et écriture un fichier `.docx` ?"><p class=jli-notice-title>Lire et écriture un fichier `.docx` ?</p><p>Au passage, il faut que les modèles soient des vrais <code>.docx</code>, <code>dotx</code> ou <code>dotm</code> (même <code>magicnumber</code> égale à<code>8075</code> .</p><p>Un document <code>.doc</code> ne pourra pas être lu.</p></div><ul><li><p>Remplacer chaque balise à partir de la liste prédéfinie.</p></li><li><p>Écrire le fichier.</p></li></ul><h2 id=le-code>Le code</h2><p>J’ai créé un projet sur GitHub où vous pouvez trouver le code pour démontrer l’algorithme.</p><p>Vous trouverez <a href=https://github.com/JeremieLitzler/demo-word-doc-generator>le code de démonstration sur GitHub</a>.</p><p>Le projet <code>Jeremie.Codes.Core.WordGenerator</code> contient la logique pour transformer le document modèle en document final.</p><p>J’ai défini 3 Dto :</p><ul><li><p><code>ProcessedDocumentInputs.cs</code> contient</p><ul><li>Le chemin absolu de la copie du modèle à utiliser.</li><li>Un dictionnaire clé-valeur pour simplifier le plus possible le traitement de remplacement des balises. La clé est la balise (<code>{{UneBalise}}</code> par exemple) et la valeur correspond à la donnée qui va remplacer la balise.</li></ul></li><li><p><code>ProcessedDocumentOutput.cs</code> contient</p><ul><li>Le contenu binaire du fichier Word après le remplacement des balises.</li><li>Une liste de messages indiquant s’il y a eu des erreurs ou si le document contient des erreurs du point de vue <code>OpenXml</code>.</li></ul></li><li><p><code>TemporaryFileInfo.cs</code> contient le chemin absolu et le nom de la copie du modèle.</p></li></ul><p>Le service se compose de 2 méthodes publiques :</p><ul><li><p><code>CreateTemporaryDocument</code> réalise la copie du modèle dans un nouveau fichier nommé pour être unique. La méthode vérifie bien sûr que le modèle existe bien et que la copie réussit.</p></li><li><p><code>ReplacePlaceholders</code> ouvre le fichier en écriture (Le <code>true</code> en second argument de <code>WordprocessingDocument.Open</code>) et boucle sur la liste des balises pour les remplacer avec la donnée finale respective.</p><ul><li>L&rsquo;écriture est réalisée sur le <code>Dispose</code> que nous sommes dans un <code>Using</code>.</li></ul></li></ul><p>Le projet <code>Jeremie.Codes.Core.WordGenerator.Tests</code> démontre l’usage du service, en particulier la construction du dictionnaire de clé-valeur.</p><p>Cette approche du dictionnaire permet à <code>Jeremie.Codes.Core.WordGenerator</code> d’être indépendant, ce qui était une obligation dans le projet concret afin d’éviter une dépendance circulaire.</p><p>Vous avez aimé ? Partagez !</p><p>À bientôt pour un nouvel article.</p></section><footer class=article-footer><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licencié sous CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Contenus liés</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/post/2024-02/enregistrer-globalement-des-composants-dans-vue3-et-typescript/><div class=article-image><img src=/images/2024-02/2024-02-27/preview-of-main.ts-file.jpg loading=lazy data-key data-hash=/images/2024-02/2024-02-27/preview-of-main.ts-file.jpg alt=" Enregistrer globalement des composants dans Vue 3"></div><div class=article-details><h2 class=article-title>Enregistrer globalement des composants dans Vue 3</h2></div></a></article><article class=has-image><a href=/post/2024-02/migrer-site-wordpress-vers-ms-azure/><div class=article-image><img src=/post/2024-02/migrer-site-wordpress-vers-ms-azure/images/_hu3ab7efb706468219c54a44979d10b083_87483_a94a5d35e3572ba6d8ba184c43d5d52c.png width=250 height=150 loading=lazy alt=" Comment migrer un site WordPress vers Microsoft Azure ?" data-hash="md5-lEZQVguvTEW2z3RCyUseXg=="></div><div class=article-details><h2 class=article-title>Comment migrer un site WordPress vers Microsoft Azure ?</h2></div></a></article><article><a href=/post/2023-12/comment-verifier-un-fichier-televerse/><div class=article-details><h2 class=article-title>Vérifiez vraiment ce qu'est un fichier téléversé</h2></div></a></article><article class=has-image><a href=/post/2023-09/migrer-de-vuepress-a-hugo/><div class=article-image><img src=/post/2023-09/migrer-de-vuepress-a-hugo/images/_hu8d586a1c04cf51476b2b5069cfd56fc5_105475_5302e38f3bd7122124d9b3baaff4a96f.jpg width=250 height=150 loading=lazy alt=" Migrer de Vuepress à Hugo" data-hash="md5-bczh3ErpHa6VPZvVkpWJ7Q=="></div><div class=article-details><h2 class=article-title>Migrer de Vuepress à Hugo</h2></div></a></article><article class=has-image><a href=/post/2023-05/activer-netlifycms-sur-son-site-web/><div class=article-image><img src=/images/2023-04-19-jamstack-javascript-apis-markup.webp loading=lazy data-key data-hash=/images/2023-04-19-jamstack-javascript-apis-markup.webp alt=" Activer l'édition du contenu de son site web"></div><div class=article-details><h2 class=article-title>Activer l'édition du contenu de son site web</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2021 -
2024 Jérémie Litzler</section><section class=powerby>License GPLv3 | <a href=https://jeremielitzler.fr/page/mentions-legales/ title="Lire les mentions légales">Mentions légales</a><br>Généré avec <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Thème <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.24.0>Stack</a></b> conçu par <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>